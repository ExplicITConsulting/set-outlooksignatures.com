---
layout: none
permalink: /sitemap.xml
---

<?xml version="1.0" encoding="UTF-8"?>
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9"
        xmlns:xhtml="http://www.w3.org/1999/xhtml"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.sitemaps.org/schemas/sitemap/0.9
                            http://www.w3.org/2001/XMLSchema-instance/sitemap.xsd">

{% assign all_content = site.html_pages %}
{% for collection in site.collections %}
  {% if collection.output %}
    {% assign all_content = all_content | concat: collection.docs %}
  {% endif %}
{% endfor %}

{% assign default_lang = site.default_lang | default: "en" %}
{% assign languages_string = site.languages | default: "en,de" %}
{% assign languages = languages_string | split: "," %}

{% comment %}
  Apply all filtering conditions directly before grouping.
  This makes the `group_by_exp` line longer but avoids an intermediate variable.
{% endcomment %}
{% assign grouped_pages = all_content
  | group_by_exp: "item", "item.url | split: '/' | slice: 1, -1 | join: '/' | remove_first: item.lang | remove_first: '/'"
%}

{% for group in grouped_pages %}
  {% assign pages_in_group = group.items %}
  {% assign canonical = nil %}
  {% for page in pages_in_group %}
    {% if page.lang == default_lang %}
      {% assign canonical = page %}
      {% break %}
    {% endif %}
  {% endfor %}
  {% if canonical == nil %}
    {% assign canonical = pages_in_group | first %}
  {% endif %}

  {% if canonical %} {# Only output URL if a canonical page was found #}
  <url>
    <loc>{{ site.url }}{{ canonical.url }}</loc>
    {% for lang in languages %}
      {% assign alt = pages_in_group | where: "lang", lang | first %}
      {% if alt %}
        <xhtml:link rel="alternate" hreflang="{{ lang }}" href="{{ site.url }}{{ alt.url }}" />
      {% endif %}
    {% endfor %}
    <xhtml:link rel="alternate" hreflang="x-default" href="{{ site.url }}{{ canonical.url }}" />
    <lastmod>{{ canonical.date | default: "now" | date_to_xmlschema }}</lastmod>
    <changefreq>daily</changefreq>
    <priority>0.8</priority>
  </url>
  {% endif %}
{% endfor %}

</urlset>