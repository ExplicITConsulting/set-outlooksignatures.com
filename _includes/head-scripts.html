<!-- mtrcs js code -->
<script>
  var _paq = window._paq = window._paq || [];
  _paq.push(["setRequestMethod", "POST"]);
  _paq.push(["disableCookies"]);
  _paq.push(["deleteCookies"]);
  _paq.push(["disableAlwaysUseSendBeacon"]);
  _paq.push(["disableQueueRequest"]);
  _paq.push(["setDocumentTitle", document.domain + ": " + document.title]);
  _paq.push(["setCookieDomain", "*.set-outlooksignatures.com"]);
  _paq.push(["setDomains", ["*.set-outlooksignatures.com"]]);
  _paq.push(['enableHeartBeatTimer']);
  _paq.push(['setLinkClasses', ["mtrcs-external-link", "mtrcs-internal-link"]]);
  _paq.push(['setDownloadClasses', ["mtrcs-download"]]);
  _paq.push(['trackPageView']);
  _paq.push(['trackVisibleContentImpressions', true]);
  _paq.push(['enableLinkTracking']);


  (
    function () {
      var u = "//mtrcs.set-outlooksignatures.com/";
      _paq.push(["setTrackerUrl", u + "poop.php"]);
      _paq.push(["setSiteId", "1"]);
      var d = document;
      g = d.createElement("script");
      s = d.getElementsByTagName("script")[0];
      g.type = "text/javascript";
      g.async = true;
      g.defer = true;
      g.src = u + "poop.js";
      s.parentNode.insertBefore(g, s);
    }
  )();
</script>


<!-- mtrcs no js code -->
<noscript>
  <p>
    <img referrerpolicy="no-referrer-when-downgrade"
      src='//mtrcs.set-outlooksignatures.com/poop.php?idsite=1&amp;bots=1&amp;rec=1&amp;action_name=page_view&amp;url={{ site.url }}{{ page.url | relative_url }}&amp;rand={{ "now" | date: "%s" }}&amp;apiv=1'
      style="border:0;" alt="" />
  </p>
</noscript>


<!-- mtrcs youtube code -->
<script>
  document.addEventListener('DOMContentLoaded', async () => {
    const playerElement = document.getElementById('youtube-video-player');
    if (playerElement) {
      // Define the onYouTubeIframeAPIReady function before loading the script.
      // The YouTube API will call this function automatically once it's loaded.
      window.onYouTubeIframeAPIReady = () => {
        // Create a new YT.Player object for the iframe with id="youtube-video-player"
        window.player = new YT.Player('youtube-video-player', {
          events: {
            'onStateChange': onPlayerStateChange
          }
        });
      };

      // This function is called by the YouTube API whenever the player's state changes.
      function onPlayerStateChange(event) {
        const videoTitle = "Set-OutlookSignatures Demo"; // Customize this
        const currentTime = window.player.getCurrentTime();

        if (event.data === YT.PlayerState.PLAYING) {
          // Track when the video starts playing
          _paq.push(['trackEvent', 'Video', 'Play', videoTitle, Math.round(currentTime)]);
        } else if (event.data === YT.PlayerState.PAUSED) {
          // Track when the video is paused
          _paq.push(['trackEvent', 'Video', 'Pause', videoTitle, Math.round(currentTime)]);
        } else if (event.data === YT.PlayerState.ENDED) {
          // Track when the video ends
          _paq.push(['trackEvent', 'Video', 'Ended', videoTitle, Math.round(currentTime)]);
        }
      }

      // Dynamically create and append the script tag to the body.
      // This is the key step that loads the script only when needed.
      const script = document.createElement('script');
      script.src = 'https://www.youtube.com/iframe_api';
      document.body.appendChild(script);
    }
  });
</script>


<!-- Add html hash to language switcher links -->
<script>
  document.addEventListener('DOMContentLoaded', async () => {
    // Define a function to handle the link updates
    const updateLanguageLinks = () => {
      const currentHash = window.location.hash;
      const languageLinks = document.querySelectorAll('a[data-base-url]');

      languageLinks.forEach(link => {
        const baseHref = link.getAttribute('data-base-url');
        link.href = baseHref + currentHash;
      });
    };

    // Initial call when the DOM is ready
    updateLanguageLinks();

    // Listen for hash changes and update the links again
    window.addEventListener('hashchange', updateLanguageLinks);
  });
</script>


<!-- Code for delete button in notifications -->
<script>
  document.addEventListener('DOMContentLoaded', async () => {
    (document.querySelectorAll('.notification .delete') || []).forEach(($delete) => {
      const $notification = $delete.parentNode;

      $delete.addEventListener('click', () => {
        $notification.parentNode.removeChild($notification);
      });
    });
  });
</script>


<!-- Button animation -->
<script>
  document.addEventListener('DOMContentLoaded', async () => {
    const buttons = document.querySelectorAll('.button');
    const delayBetweenButtons = 400; // 0.2-second stagger
    const animationFrequency = 5000; // 4-second frequency for each button

    buttons.forEach((button, index) => {
      setTimeout(() => {
        setInterval(() => {
          button.classList.add('animated-now');
          setTimeout(() => {
            button.classList.remove('animated-now');
          }, 1000); // Remove class after the 1-second animation completes
        }, animationFrequency);
      }, index * delayBetweenButtons);
    });
  });
</script>


<!-- Scrolling customer images banner -->
<script>
  document.addEventListener('DOMContentLoaded', async () => {
    const track = document.querySelector('.scrolling-track');
    const banner = document.querySelector('.scrolling-banner');

    if (!track || !banner) {
      console.warn('Scrolling track or banner element not found. Please ensure the HTML structure is correct.');
      return;
    }

    try {
      const response = await fetch('https://set-outlooksignatures.com/customer-images.txt');
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      const text = await response.text();
      let urls = text.split('\n').map(line => line.trim()).filter(Boolean);

      urls = [...new Set(urls)];

      if (urls.length === 0) {
        console.warn('No image URLs found. Banner will not display images.');
        return;
      }

      // Shuffle the URLs
      for (let i = urls.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [urls[i], urls[j]] = [urls[j], urls[i]];
      }

      const originalShuffledUniqueUrls = [...urls];
      // Repeat the URLs to ensure a seamless scroll effect
      const finalUrlsForDOM = [...originalShuffledUniqueUrls, ...originalShuffledUniqueUrls, ...originalShuffledUniqueUrls];

      track.innerHTML = '';

      // --- Intersection Observer Logic for Lazy Loading ---
      const imageElements = [];
      const observer = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const img = entry.target;
            const src = img.getAttribute('data-src');
            if (src) {
              img.src = src; // Set the src to trigger image download
              img.onload = () => observer.unobserve(img);
              img.onerror = () => observer.unobserve(img);
            }
          }
        });
      }, {
        // Load images when they are within 200 pixels of the viewport
        rootMargin: '200px'
      });

      // Create img elements with placeholders and a data-src attribute
      finalUrlsForDOM.forEach(url => {
        const img = document.createElement('img');
        img.setAttribute('data-src', url);
        img.alt = `https://${url.split('/').pop()?.split('.').slice(0, -1).join('.')}` || 'Customer Logo';
        // Use a tiny transparent placeholder GIF to prevent broken image icons
        img.src = 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=';
        img.classList.add('lazy-image');

        track.appendChild(img);
        imageElements.push(img);
        observer.observe(img); // Start observing the element
      });

      // Wait for a short duration or a specific event to ensure initial images are loaded
      // and their dimensions are available before calculating the animation.
      setTimeout(() => {
        requestAnimationFrame(() => {
          const bannerWidth = banner.clientWidth;
          const computedStyle = getComputedStyle(track);
          const gapSize = parseFloat(computedStyle.gap) || 0;

          let scrollDistance = 0;
          // Calculate the scroll distance based on the dimensions of the first set of images
          for (let i = 0; i < originalShuffledUniqueUrls.length; i++) {
            const img = track.children[i];
            if (img) {
              scrollDistance += img.offsetWidth;
              if (i < originalShuffledUniqueUrls.length - 1) {
                scrollDistance += gapSize;
              }
            }
          }

          if (scrollDistance <= 0 || track.scrollWidth <= bannerWidth + 1) {
            console.warn('Content is not wide enough to scroll. Disabling animation.');
            track.style.animation = 'none';
            return;
          }

          const pixelsPerSecond = 50;
          const animationDuration = scrollDistance / pixelsPerSecond;
          const animationName = 'scroll-full-track-dynamic-' + Date.now();

          let styleSheet = document.getElementById('dynamic-scroll-animation-style');
          if (!styleSheet) {
            styleSheet = document.createElement('style');
            styleSheet.id = 'dynamic-scroll-animation-style';
            document.head.appendChild(styleSheet);
          } else {
            while (styleSheet.sheet && styleSheet.sheet.cssRules.length > 0) {
              styleSheet.sheet.deleteRule(0);
            }
          }

          const keyframesRule = `
                    @keyframes ${animationName} {
                        from { transform: translateX(0); }
                        to { transform: translateX(${-scrollDistance}px); }
                    }
                `;
          styleSheet.sheet.insertRule(keyframesRule, styleSheet.sheet.cssRules.length);

          track.style.animation = `${animationName} ${animationDuration}s linear infinite`;
          track.style.animationPlayState = 'running';
        });
      }, 100); // Small delay to allow initial image dimensions to be available
    } catch (error) {
      console.error('Failed to fetch or process image URLs:', error);
    }
  });
</script>


<!-- Update download links to latest release of Set-OutlookSignatures -->
<script>
  async function updateDownloadLink() {
    const owner = 'Set-OutlookSignatures';
    const repo = 'Set-OutlookSignatures';
    const repoURL = `https://api.github.com/repos/${owner}/${repo}/releases/latest`;

    try {
      const response = await fetch(repoURL);
      if (!response.ok) {
        throw new Error(`GitHub API request failed with status: ${response.status}`);
      }

      const data = await response.json();
      const firstAsset = data.assets[0];

      if (firstAsset && firstAsset.browser_download_url) {
        const downloadLinks = document.querySelectorAll('.sos-download-link');
        if (downloadLinks.length > 0) {
          downloadLinks.forEach(link => {
            link.href = firstAsset.browser_download_url;
          });
        } else {
          // console.warn('No elements with class "sos-download-link" found.');
        }
      } else {
        console.error('No assets found for the latest release.');
      }
    } catch (error) {
      console.error('Error fetching latest release:', error);
    }
  }

  document.addEventListener('DOMContentLoaded', updateDownloadLink);
</script>