<nav class="navbar is-primary {% if site.fixed_navbar %} is-fixed-{{ site.fixed_navbar }} {% endif %}"
    x-data="{ openNav: false }">
    <div class="container">
        <div class="navbar-brand">
            <a href="{{ site.baseurl }}/" class="navbar-item has-text-white">
                <img src="/assets/images/set-outlooksignatures logo.png" alt="Set-OutlookSignatures">
            </a>
            <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="navMenu"
                :class="{ 'is-active': openNav }" x-on:click="openNav = !openNav">
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
            </a>
        </div>


        <script id="nav-default" type="application/json">
            {{ site.data.navigation | jsonify }}
        </script>

        {% assign nav_files = site.data | keys | where_exp: "key", "key contains 'navigation_'" %}
        {% for nav_key in nav_files %}
            <script id="nav-{{ nav_key | remove: 'navigation_' }}" type="application/json">
                {{ site.data[nav_key] | jsonify }}
            </script>
        {% endfor %}

        <div class="navbar-menu" id="navMenu" :class="{ 'is-active': openNav }">
            <div class="navbar-start">
                <!-- <a href="{{ site.baseurl }}/" class="navbar-item has-text-white {% if page.url == "/" %}is-active{% endif %}">Features</a> -->
                <script>
                    document.addEventListener("DOMContentLoaded", function () {
                        const preferredLanguage = localStorage.getItem("languageDropdownValue") || "default";
                        const navbar = document.getElementById("navbar-start");

                        function buildNavbar(navData) {
                            navbar.innerHTML = "";

                            navData.forEach(item => {
                                if (item.dropdown) {
                                    const dropdown = document.createElement("div");
                                    dropdown.className = "navbar-item has-dropdown is-hoverable";

                                    const link = document.createElement("a");
                                    link.href = item.link;
                                    link.className = "navbar-link has-text-white";
                                    link.textContent = item.name;

                                    const dropdownMenu = document.createElement("div");
                                    dropdownMenu.className = "navbar-dropdown";

                                    item.dropdown.forEach(subitem => {
                                        const subLink = document.createElement("a");
                                        subLink.href = subitem.link;
                                        subLink.className = "navbar-item";
                                        subLink.textContent = subitem.name;
                                        dropdownMenu.appendChild(subLink);
                                    });

                                    dropdown.appendChild(link);
                                    dropdown.appendChild(dropdownMenu);
                                    navbar.appendChild(dropdown);
                                } else {
                                    const link = document.createElement("a");
                                    link.href = item.link;
                                    link.className = "navbar-item has-text-white";
                                    link.textContent = item.name;
                                    navbar.appendChild(link);
                                }
                            });
                        }

                        function loadNavbarForLanguage(lang) {
                            const navScript = document.getElementById("nav-" + lang) || document.getElementById("nav-default");
                            if (navScript) {
                                const navData = JSON.parse(navScript.textContent);
                                buildNavbar(navData);
                            }
                        }

                        loadNavbarForLanguage(preferredLanguage);
                    });
                </script>
            </div>

            <div class="navbar-end">
                <a class="navbar-item has-text-white" href="/search">
                    <span class="icon"><i class="fas fa-search"></i></span>
                    <span></span>
                </a>

                <div class="navbar-item has-text-white">
                    <select id="languageDropdown" name="languageDropdown"
                        onchange="localStorage.setItem('languageDropdownValue', this.value); location.reload();">
                        <option value="de">Deutsch</option>
                        <option value="en">English</option>
                    </select>
                </div>

                {% if site.gh_sponsor %}
                <a class="navbar-item has-text-white" href="https://github.com/sponsors/{{ site.gh_sponsor }}">
                    <span class="icon gh-sponsor"><i class="fas fa-heart"></i></span>
                    <span>Sponsor</span>
                </a>
                {% endif %}
            </div>
        </div>
    </div>
</nav>